<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Effectivats-DiningPhil</title>
</head>

<body>

<h1>
Effective ATS: Dining Philosophers
</h1>

The three most distinguished features of ATS are dependent types, linear
types, and localizable templates. In this article, I present an
implementation of the famous problem of 5-Dining-Philosophers by Dijkstra
that makes simple but convincing use of linear types.

<h2>
Description of the Problem 
</h2>

There are five philosophers sitting around a table and there are also 5
forks placed on the table such that each fork is located between the left
hand of a philosopher and the right hand of another philosopher. Each
philosopher does the following routine repeatedly: thinking and dining.  In
order to dine, a philosopher needs to first acquire two forks: one located
on his left-hand side and the other on his right-hand side. After
finishing dining, a philosopher puts the two acquired forks onto the table:
one on his left-hand side and the other on his right-hand side.

<h2>
A Linear Type for Resources
</h2>

First, let us introduce a type definition as follows:

<pre>
typedef phil = int
</pre>

The sole purpose of using [phil] instead of [int] as the type for
philosophers is to make the presented code easier to follow.

<p>

Let us next introduce a linear abstract type for forks (which are
resources):

<pre>
absvt@ype fork = int
</pre>

Note that this declaration means that [fork] is an abstract viewtype (that
is, a linear abstract type) whose size equals the size of [int].  Note that
the information on [fork] and [int] being of the same size is not available
until after typechecking when abstract types are replaced with concrete types.

<p>

For a philosopher to acquire and release his left fork, the following
functions can be called:
<pre>
fun phil_acquire_lfork (n: phil): fork
fun phil_release_lfork (n: phil, f: fork): void
</pre>

For a philosopher to acquire and release his right fork, the following
functions can be called:
<pre>
fun phil_acquire_rfork (n: phil): fork
fun phil_release_rfork (n: phil, f: fork): void
</pre>

As forks are shared resources, these functions for acquiring and releasing
forks should in general involve some sort of locking mechanism. If a fork
is acquired, then it should be released after its use. By assigning a
linear type to forks, we can rely on the type system of ATS to keep track
of forks, ensuring their being handled properly.

<h2>
Philosopher Implemented as a Loop 
</h2>

<pre>
fun phil_dine (n: phil): void
fun phil_think (n: phil): void
</pre>

<pre>
fun phil_loop (n: phil): void
</pre>


<hr size="2">

This article is written by <a href="http://www.cs.bu.edu/~hwxi/">Hongwei Xi</a>.

</body>
</html>
